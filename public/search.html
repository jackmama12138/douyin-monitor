<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>主播搜索</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    [v-cloak] { display: none; }
    .scrollbar-hide::-webkit-scrollbar { display: none; }
    .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>

<body class="bg-gray-50 text-slate-800 antialiased">

<div id="app" class="min-h-screen flex flex-col" v-cloak>

  <!-- 顶部导航 -->
  <header class="bg-white border-b border-gray-200 sticky top-0 z-50 shadow-sm">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-9 h-9 rounded-xl bg-blue-600 flex items-center justify-center text-white shadow-blue-200 shadow-lg">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
          </svg>
        </div>
        <a href="index.html" class="font-bold text-xl tracking-tight text-slate-900 hover:text-blue-600 transition">直播监控</a>
      </div>
      
      <nav class="hidden md:flex items-center gap-1">
        <a href="search.html" class="px-3 py-2 text-sm font-bold text-blue-600 bg-blue-50 rounded-lg">搜索主播</a>
        <a href="history.html" class="px-3 py-2 text-sm font-medium text-slate-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition">历史记录</a>
        <a href="hls.html" class="px-3 py-2 text-sm font-medium text-slate-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition">HLS播放器</a>
        <a href="room.html" class="px-3 py-2 text-sm font-medium text-slate-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition">房间详情</a>
        <a href="index.html" class="px-3 py-2 text-sm font-medium text-slate-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition">控制台</a>
      </nav>

      <!-- 移动端菜单按钮 -->
      <button class="md:hidden p-2 text-gray-500">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
      </button>
    </div>
  </header>

  <!-- 主体内容 -->
  <main class="flex-1 max-w-7xl mx-auto w-full px-4 sm:px-6 lg:px-8 py-8">

    <!-- 顶部搜索与标题栏 -->
    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
      <div>
        <h1 class="text-2xl font-bold text-slate-900">搜索主播</h1>
        <p class="text-slate-500 text-sm mt-1">通过关键词查找抖音主播并添加监控</p>
      </div>
      
      <div class="flex items-center gap-2 w-full md:w-auto">
        <div class="relative flex-1 md:w-80 group">
          <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
            <svg class="h-5 w-5 text-gray-400 group-focus-within:text-blue-500 transition" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
          </div>
          <input
              v-model="keyword"
              placeholder="请输入主播名称或ID..."
              class="block w-full pl-10 pr-3 py-2.5 border border-gray-200 rounded-xl leading-5 bg-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition shadow-sm sm:text-sm"
          >
        </div>
        <button
              @click="search"
              class="bg-blue-600 hover:bg-blue-700 text-white px-5 py-2.5 rounded-xl text-sm font-medium shadow-sm shadow-blue-200 transition active:scale-95 whitespace-nowrap"
        >
          搜索主播
        </button>
      </div>
    </div>

    <!-- 搜索结果 -->
    <div v-if="list.length" class="bg-white rounded-2xl shadow-sm overflow-hidden">

      <!-- 表头 -->
      <div class="grid grid-cols-5 text-gray-400 text-sm px-6 py-4 border-b hidden md:grid">
        <div>主播信息</div>
        <div>ID</div>
        <div class="text-center">粉丝数</div>
        <div class="text-center">aid</div>
        <div class="text-center">操作</div>
      </div>

      <!-- PC 列表 -->
      <div v-for="item in list" :key="item.anchor_id"
           class="hidden md:grid grid-cols-5 items-center px-6 py-5 border-b last:border-0 hover:bg-gray-50 transition">

        <!-- 主播 -->
        <div class="flex items-center gap-3">
          <img :src="item.avatar_url" class="w-11 h-11 rounded-full">
          <div class="font-medium">{{ item.nick_name }}</div>
        </div>

        <!-- ID -->
        <div class="text-gray-500">{{ item.display_id }}</div>

        <!-- 粉丝 -->
        <div class="text-center text-gray-500 text-sm">
          {{ item.fans_num.toLocaleString() }}
        </div>

        <!-- anchor_id -->
        <div class="text-center text-gray-500 text-sm">
          {{ item.anchor_id }}
        </div>

        <!-- 操作 -->
        <div class="text-center">
          <div class="flex  gap-2 justify-center">
            <button
                    @click="add(item.display_id)"
                    class="bg-blue-500 hover:bg-blue-600 text-white text-sm px-4 py-2 rounded-lg"
            >
              添加监控
            </button>
            <button
                    @click="viewHistory(item.anchor_id)"
                    class="bg-green-500 hover:bg-green-600 text-white text-sm px-4 py-2 rounded-lg"
            >
              直播动态
            </button>
          </div>
        </div>

      </div>

      <!-- ✅ 手机卡片模式 -->
      <div class="md:hidden space-y-3 p-3">
        <div v-for="item in list" :key="item.anchor_id"
             class="bg-gray-50 rounded-xl p-4 flex items-center justify-between">

          <div class="flex items-center gap-3">
            <img :src="item.avatar_url" class="w-10 h-10 rounded-full">
            <div>
              <div class="font-medium text-sm">{{ item.nick_name }}</div>
              <div class="text-xs text-gray-400">{{ item.display_id }}</div>
            </div>
          </div>

          <div class="flex flex-col gap-1 items-end">
            <button
                    @click="add(item.display_id)"
                    class="bg-blue-500 text-white text-xs px-3 py-1 rounded-lg"
            >
              添加
            </button>
            <button
                    @click="viewHistory(item.anchor_id)"
                    class="bg-green-500 text-white text-xs px-3 py-1 rounded-lg"
            >
              历史
            </button>
          </div>

        </div>
      </div>

    </div>

    <!-- ✅ 状态提示 -->
    <div v-if="toast"
         class="fixed top-6 left-1/2 -translate-x-1/2 bg-black/80 text-white text-sm px-5 py-3 rounded-full shadow-lg">
      {{ toast }}
    </div>

  </div>
</div>

<script>
  const { createApp } = Vue

  createApp({
    data() {
      return {
        keyword: '',
        list: [],
        toast: '',
        apiBase: 'http://localhost:8000/api'
      }
    },
    
    mounted() {
      // 从URL获取参数并自动填充搜索框
      const urlParams = new URLSearchParams(window.location.search);
      // 支持rid参数
      const rid = urlParams.get('rid') || '旭旭宝宝';
      if (rid) {
        this.keyword = rid;
        this.search();
      }
      // 兼容已有的room_id参数
      const roomId = urlParams.get('room_id');
      if (roomId && !rid) {
        this.keyword = roomId;
        this.search();
      }
    },

    methods: {
      async search() {
        if (!this.keyword) return this.showToast('请输入关键词')
        
        // 更新URL参数，支持分享和收藏
        const urlParams = new URLSearchParams(window.location.search);
        urlParams.set('rid', this.keyword);
        window.history.replaceState(null, '', `?${urlParams.toString()}`);
        
        const res = await fetch(`${this.apiBase}/search/${encodeURIComponent(this.keyword)}`)
        const data = await res.json()
        this.list = data.data || []
      },

      async add(id) {
        const d = await fetch(`${this.apiBase}/add/${id}`)
        if (d.status !== 200) return this.showToast('❌ 添加失败')
        this.showToast('✅ 已添加监控')
      },

      showToast(msg) {
        this.toast = msg
        setTimeout(() => this.toast = '', 2000)
      },
      
      // 查看主播历史直播记录
      viewHistory(aid) {
        window.location.href = `history.html?rid=${aid}`;
      }
    }
  }).mount('#app')
</script>

</body>
</html>
